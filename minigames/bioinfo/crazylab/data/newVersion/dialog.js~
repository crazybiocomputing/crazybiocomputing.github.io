
/*********************
 * @class Dialog
 *
 *********************/
function Dialog(a_chat) {
  console.log('create');
  this.html    = a_chat.html    || '';
  this.widgets = a_chat.widgets || [];
  this.element = a_chat.element || null;
  this.people  = a_chat.people  || 'anna';
}


Dialog.prototype.update = function () {
  var button_html='';
  var str = this.html;
  for (var i = 0; i < dialog[ID].widgets.length; i++ ) {
    button_html = this.createWidget(ID,this.widgets[i]);
    str = str.replace(new RegExp('__'+this.widgets[i].type+'__'),button_html);
  }
  document.getElementById(this.element).innerHTML = str;

  // People
  var head = this.people;
  if (this.people === 'previous') {
    head = dialog[path[path.length - 2].ID ].people;
  }
  switch (head) {
  case 'boy':
    people = '<img src="anna.svg"></img></div>'
    break;
  case 'girl':
    people = '<div style="width:200px; overflow: hidden;"><img src="../../img/people.png"  style = "margin-left:-200px;" width="600px"></img></div>'
    break;
  case 'anna':
    people = '<div style="width:200px; overflow: hidden;"><img src="../../img/people.png"  style = "margin-left:-400px;" width="600px"></img></div>'
    break;
  }
  document.getElementById('people').innerHTML=people;


//DEBUG  logpath();
}

Dialog.prototype.createWidget = function (ID,widget) {
  var str='';
  switch (widget.type) {
  case 'back':
    str += '<a class="right_button" href="javascript:void(0)" ';
    str += widget.event+'="checkAnswer(';
    str += '{ID:\''+ID+'\',type:\'back\'}';
    str += ')">'+widget.title+'</a>';
    break;
  case 'button':
    str += '<a class="right_button" href="javascript:void(0)" ';
    str += widget.event+'="checkAnswer(';
    str += '{ID:\''+ID+'\',type:\'button\'}';
    str += ')">'+widget.title+'</a>';
    break;
  case 'html':
    // Display message randomly
    str = widget.title[Math.floor(Math.random() * widget.title.length)];
    break;
  case 'numeric':
    str = '<input type="text" id="'+widget.id+'"  size="8" value="'+widget.title+'" onkeyup="this.value=this.value.replace(/[^\\d.]/,\'\')"></input>';
    break;
  case 'select':
    str = '<select id="'+widget.id+'" ';
    if (widget.event !== undefined) {
      str += widget.event+'="checkAnswer({ID:\''+ID+'\',type:\'select\',element:\''+widget.id+'\'})"';
    }
    str +='>';
    for (var i =0; i < widget.options.length; i++) {
      str += '<option value="'+widget.options[i]+'">'+widget.options[i]+'</option>';
    }
    str +='</select>';
    break;
  case 'submit':
    str += '<a class="right_button" href="javascript:void(0)" ';
    str += widget.event+'="checkAnswer(';
    str += '{ID:\''+ID+'\',type:\'submit\'}';
    str += ')">'+widget.title+'</a>';
    break;
  case 'text':
    str = '<input type="text" id="'+widget.id+'" size="8" value="'+widget.title+'"></input>';
    break;
  case 'value':
    break;
  default:
    // Do nothing
  }

  return str;
}
