
var CLICKABLE=0;
var CLOSABLE=2; // == CLICKABLE_CLOSE
var CONTAINABLE=4; // == CLICKABLE_POPUP
var LINKABLE=8;
var MOVABLE=16;
var RENDERABLE=32;
var RESIZABLE=64;
var REVEALABLE=128;
var ROTATABLE=256;
var SCROLLABLE=512;

var TOKENSIZE = 100;

var TOKEN_PROPS = CLOSABLE | CONTAINABLE | LINKABLE | MOVABLE | RENDERABLE | ROTATABLE;

var knots_coords=[];
knots_coords['o']={'rect':'rect(0px 100px 100px   0px)','left':0,'top':0};
knots_coords['O']={'rect':'rect(0px 200px 100px 100px)','left':-100,'top':0};
knots_coords['i']={'rect':'rect(0px 300px 100px 200px)','left':-200,'top':0};
knots_coords['I']={'rect':'rect(0px 400px 100px 300px)','left':-300,'top':0};


var TokenFactory = (function() {

  return {
    get: function (options) {
      var tok = new Token(options);
      console.log(tok.description.title +' '+tok.width);
      tok.html='<div class="token" id="'+tok.ID+'" onmousedown="move(this,event)">';

      // Background + button(s)
      if ( (tok.props & CLOSABLE) && (tok.props & ROTATABLE) ) {
        console.log('closable? ' + tok.props.toString(2)+ ' ' + CLOSABLE + ' ' + (tok.props & CLOSABLE) );
        tok.html+='<img src="'+tok.background+'" style="position:absolute;left:-100px;clip:rect(0px 200px 100px 100px);"  onmousedown="return false;">';
      }
      else if ( (tok.props & CLOSABLE) ) {
        tok.html+='<img style="position:absolute;left:-200px;clip:rect(0px 300px 100px 200px);" src="'+tok.background+'" onmousedown="return false;">';
      }
      else {
        tok.html+='<img style="position:absolute;left:-300px;clip:rect(0px 400px 100px 300px);" src="'+tok.background+'" onmousedown="return false;">';
      }

      // Knot(s)
      for (var i=0;i<4;i++) {
        if (tok.knots[i]!= 'x') {
          tok.html+='<img class="knot" id="'+tok.knots[i].toLowerCase()+i+'_'+tok.ID+'" src="../crazybioflow/img/knots_row.png" onmousedown="return false;">';
        }
      }

      // Icon
      tok.html+='<img title="'+tok.title+'" style="display:block; position:absolute; top:0px; left:0px;" src="'+tok.icon+'" onmousedown="return false;">';

      tok.html+='</div';
      return tok;
    }
  }

})();


function Token(options) {
  // Init
  this.ID = options.ID || -1;
  this.props = options.props || (CLOSABLE | CONTAINABLE | LINKABLE | MOVABLE | RENDERABLE | ROTATABLE);
  this.status = -1;
  this.orgx = options.orgx || 0;
  this.orgy = options.orgy || 0;
  this.width = options.width || 100;
  this.height = options.height || 100;
  this.type = options.type || 'X';
  this.title = options.title || 'No title';
  this.angle = options.angle || 0;
  this.description = options.description  || {title:'None',contents:''}; 
  this.cell_x = (options.cell_x != null) ? options.cell_x : -1;
  this.cell_y = (options.cell_y != null) ? options.cell_y : -1;
  this.knots=options.knots || 'ioxx';
  this.background=options.background || '../crazybioflow/img/background_token.png';
  this.icon=options.icon || '../crazybioflow/img/question_mark.png';

  console.log('new Token '+this.ID+ ' '+this.cell_x+' '+this.cell_y+' '+this.props);
}




